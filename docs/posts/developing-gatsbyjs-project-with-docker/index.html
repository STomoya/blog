<!DOCTYPE html>
<html lang="en-us">
<head>
    <meta charset="utf-8">
    <link crossorigin="anonymous" media="all"
        rel="stylesheet"
        href="https://stomoya.github.io/blog/css/frameworks.css" />
    <link crossorigin="anonymous" media="all"
        rel="stylesheet" href="https://stomoya.github.io/blog/css/github.css" />
    <meta name="viewport" content="width=device-width">

    <title>Developing GatsbyJS Project with Docker - STomoya</title>

    <link rel="icon" type="image/x-icon" class="js-site-favicon" href="https://stomoya.github.io/blog/images/favicon.ico">
    <meta name="theme-color" content="#1e2327">
    
</head>

<body class="env-production emoji-size-boost page-responsive page-profile">
  <div class="position-relative js-header-wrapper ">
    <span class="Progress progress-pjax-loader position-fixed width-full js-pjax-loader-bar">
        <span class="progress-pjax-loader-bar top-0 left-0" style="width: 0%;"></span>
    </span>
    <header class="Header js-details-container Details flex-wrap flex-lg-nowrap p-responsive" role="banner">
        <div class="Header-item d-none d-lg-flex">
            <a class="Header-link" href="https://stomoya.github.io/blog/" aria-label="Homepage"
                data-ga-click="Header, go to dashboard, icon:logo">
                <svg class="octicon octicon-mark-github v-align-middle" height="32" viewBox="0 0 16 16" version="1.1"
                    width="32" aria-hidden="true">
                    <path fill-rule="evenodd"
                        d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z" />
                </svg>
            </a>
        </div>
        <div
            class="Header-item Header-item--full flex-column flex-lg-row width-full flex-order-2 flex-lg-order-none mr-0 mr-lg-3 mt-3 mt-lg-0 Details-content--hidden">
            <div class="header-search flex-self-stretch flex-lg-self-auto mr-0 mr-lg-3 mb-3 mb-lg-0 scoped-search site-scoped-search js-site-search position-relative js-jump-to"
                role="combobox" aria-owns="jump-to-results" aria-label="Search or jump to" aria-haspopup="listbox"
                aria-expanded="false">
                <div class="position-relative">
                </div>
            </div>
        </div>
        <div class="Header-item Header-item--full flex-justify-center d-lg-none position-relative" style="margin-right: auto;">
            <a class="Header-link" href="https://stomoya.github.io/blog/" aria-label="Homepage"
                data-ga-click="Header, go to dashboard, icon:logo">
                <svg class="octicon octicon-mark-github v-align-middle" height="32" viewBox="0 0 16 16" version="1.1"
                    width="32" aria-hidden="true">
                    <path fill-rule="evenodd"
                        d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z" />
                </svg>
            </a>
        </div>
        <div class="Header-item position-relative mr-0 d-none d-lg-flex">
            <details class="details-overlay details-reset">
                <summary class="Header-link" aria-label="View profile and more"
                    data-ga-click="Header, show menu, icon:avatar">
                    
                    <img alt="" class="avatar" src="https://avatars1.githubusercontent.com/u/49909252?s=400&amp;u=f86c4bceea08d6ffb846f4c170a0fba7ddc806c1&amp;v=4" height="20" width="20">
                    
                </summary>
            </details>
        </div>
    </header>
</div>

<div id="start-of-content" class="show-on-focus"></div>
<div id="js-flash-container">
</div>

  
<div class="application-main " data-commit-hovercards-enabled="">
    <div itemscope="" itemtype="http://schema.org/SoftwareSourceCode" class="">
        <main id="js-repo-pjax-container" data-pjax-container="">
            <div class="pagehead repohead instapaper_ignore readability-menu experiment-repo-nav pt-0 pt-lg-4 ">
                <div class="repohead-details-container clearfix container-lg p-responsive d-none d-lg-block">
                    <div class="mb-3 d-flex">
                        <h1 class="public css-truncate float-none flex-auto width-fit pl-0">
                            <a class="avatar mr-1" href="https://stomoya.github.io/blog/about/">
                            

                                <img
                                    src="https://avatars1.githubusercontent.com/u/49909252?s=400&amp;u=f86c4bceea08d6ffb846f4c170a0fba7ddc806c1&amp;v=4" width="26" height="26">
                            
                            </a>
                            <span class="author"><a
                                    href="https://stomoya.github.io/blog/">STomoya</a></span>
                            <span class="path-divider">/</span>
                            <strong itemprop="name" class="css-truncate-target" style="max-width: 410px"><a
                                    href="https://stomoya.github.io/blog/posts/developing-gatsbyjs-project-with-docker/">Developing GatsbyJS Project with Docker</a></strong>

                            <div class="d-block text-small text-gray">
                                Created <time-ago datetime="2020-03-28" class="no-wrap"
                                    title="Created at 2020/03/28">
                                    2020-03-28</time-ago>
                                <span class="file-info-divider"></span>
                                Modifyed <time-ago datetime="2020-03-28" class="no-wrap"
                                    title="Modified  at 2020/03/28">
                                    2020-03-28</time-ago>
                            </div>
                        </h1>
                    </div>
                </div>




            </div>
            <div class="container-lg clearfix new-discussion-timeline experiment-repo-nav  p-responsive">
                <div class="repository-content ">
                    <div class="Box mt-3 position-relative">
                        <div class="Box-header py-2 d-flex flex-column flex-shrink-0 flex-md-row flex-md-items-center">
                            <div class="text-mono f6 flex-auto pr-3 flex-order-2 flex-md-order-1 mt-2 mt-md-0">
                                609 Words
                                
                            </div>
                        </div>

                        <div id="readme" class="Box-body readme blob instapaper_body js-code-block-container">
                            <article class="markdown-body entry-content p-3 p-md-6" itemprop="text"><h1 id="developing-gatsbyjs-project-with-docker">Developing GatsbyJS Project with Docker</h1>
<p>I started to play around with GatsbyJS so I&rsquo;ll write down some of the things I learned when developing projects with docker.<br>
The <a href="https://github.com/STomoya/gatsby-playground">repository is here</a>.</p>
<h2 id="initualization">Initualization</h2>
<p>In GatsbyJS, there are ways that makes it simple to creat a project.
Follow the <a href="https://www.gatsbyjs.org/docs/">official tutorial</a> for making a project.
I used <code>https://github.com/gatsbyjs/gatsby-starter-hello-world</code> for initualizing my project.</p>
<p>Then I erased the created <code>node-modules</code> folder because I will do the development on a docker container.
<code>node-modules</code> folder is <em>very</em> heavy so if you aren&rsquo;t using it, you should erase it&hellip;</p>
<h2 id="docker">Docker</h2>
<p>Next I started creating a Docker container which lets me develop my website.<br>
<a href="https://yopinoji.com/docker-for-gatsby-js">This</a> is the site I referenced. (Its Japanese. Sorry&hellip;)</p>
<p>I created a <code>./docker/Dockerfile</code> and <code>docker-compose.yml</code> inside the project folder.</p>
<p>In my <code>Dockerfile</code>:</p>
<pre><code>FROM node:13-alpine

RUN apk add --no-cache python make g++ &amp;&amp; \
    apk add vips-dev fftw-dev --no-cache --repository http://dl-3.alpinelinux.org/alpine/edge/community --repository http://dl-3.alpinelinux.org/alpine/edge/main &amp;&amp; \
    rm -fR /var/cache/apk/*

WORKDIR /usr/src

COPY ./package.json package.json

RUN npm install

EXPOSE 8000
</code></pre><p>The base image I am using is <code>node:13-alpine</code>.
If you use the alpine linux, you need to install vips-dev.
So the first <code>RUN</code> is for installing dependencies.
Then, after changing the working directory I copy the package.json and install the dependencies of the website by <code>npm install</code>.
Finally, expose the <code>8000</code> port, which is the default port for the development server of GatsbyJS.
If you set your development server port to something else, you should expose the specific port.</p>
<p><em>You should expose the port in the <code>Dockerfile</code> and not in the <code>docker-compose.yml</code> file. It will not work.</em></p>
<p>Then in my <code>docker-compose.yml</code>:</p>
<pre><code>version: '3'

volumes:
    node_modules:

services:
  web:
    build:
      context: .
      dockerfile: ./docker/Dockerfile
    ports:
      - &quot;8000:8000&quot;
    volumes:
      - node_modules:/usr/src/node_modules
      - .:/usr/src
    environment:
      - NODE_ENV=development
    command: npm run develop
</code></pre><p>The service <code>web</code> is the main part.
I put the Dockerfile in a folder call <code>docker</code>, so I declared that in the <code>build</code>.
The <code>8000</code> port is forward to the container&rsquo;s <code>8000</code> port.
Then the volumes current folder is binded to the container&rsquo;s <code>/usr/src</code> folder.
Next I have the <code>enviornment</code> for the NodeJS.
And the command to run the development server.</p>
<p>I didn&rsquo;t need the <code>node_modules</code> to be in my local folder so I did things to exclude this folder, which is the <code>volumes</code> on the top and first line of the <code>volumes</code> in the <code>web</code>.
This is not necessary if you don&rsquo;t care much about having heavy folders on your local folders.</p>
<p>So, now you can run</p>
<pre><code class="language-console" data-lang="console">$ docker-compose build
</code></pre><p>to build the container, and</p>
<pre><code class="language-console" data-lang="console">$ docker-compose up
</code></pre><p>to start the development server.<br>
Visit <code>localhost:8000</code> to see it running.</p>
<p>To add dependencies, run</p>
<pre><code class="language-console" data-lang="console">$ docker-compose run --rm npm install &lt;package&gt;
</code></pre><p>And to build, run</p>
<pre><code class="language-console" data-lang="console">$ docker-compose run --rm npm run build
</code></pre><p>and the files will be built inside the <code>public</code> folder.</p>
<h2 id="development">Development</h2>
<p>In GatsbyJS, the changes you made to your files are detected automatically and they will run the build again to update the contents.
In order to find the changes, the development server keeps on running unless you hit <code>Ctrl+C</code> to stop the development server.</p>
<p>Also, you don&rsquo;t need to care about the server stopping when you have a bug in your program.
It wont stop even if you have a bug that makes your site unable to move.
It even shows the error message on the browser!
Wonderful:)</p>
<p>I recognized that there are several tasks in the build process, and they automatically detect where to build from by the changes that were made.
Inteligent:)</p>
<p>For the actual coding, see the <a href="https://www.gatsbyjs.org/docs/">official tutorial</a>.</p>
<h2 id="overall">Overall</h2>
<p>Thats it.<br>
I might write about the GatsbyJS itself, but many articles are on the Internet so it&rsquo;s better looking at those pages.</p>
</article>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>
</div>



  <div class="footer container-lg width-full p-responsive" role="contentinfo">
    <div
        class="position-relative d-flex flex-row-reverse flex-lg-row flex-wrap flex-lg-nowrap flex-justify-center flex-lg-justify-between pt-6 pb-2 mt-6 f6 text-gray border-top border-gray-light ">
        <ul
            class="list-style-none d-flex flex-wrap col-12 col-lg-5 flex-justify-center flex-lg-justify-between mb-2 mb-lg-0">
            <li class="mr-3 mr-lg-0">2020. STomoya All Rights Reserved</a></li>
        </ul>

        <a aria-label="Homepage" title="STomoya" class="footer-octicon d-none d-lg-block mx-lg-4"
            href="https://stomoya.github.io/blog/">
            <svg height="24" class="octicon octicon-mark-github" viewBox="0 0 16 16" version="1.1" width="24"
                aria-hidden="true">
                <path fill-rule="evenodd"
                    d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z">
                </path>
            </svg>
        </a>
        <ul
            class="list-style-none d-flex flex-wrap col-12 col-lg-5 flex-justify-center flex-lg-justify-between mb-2 mb-lg-0">
        </ul>
    </div>
    <div class="d-flex flex-justify-center pb-6">
        <span class="f6 text-gray-light"></span>
    </div>
</div>

<script crossorigin="anonymous"
    type="application/javascript" src="https://stomoya.github.io/blog/js/frameworks.js"></script>

<script crossorigin="anonymous" async="async"
    type="application/javascript" src="https://stomoya.github.io/blog/js/github-bootstrap.js"></script>
<script>
    let classs = ['pinned-item-desc', 'text-gray', 'text-small', 'd-block', 'mt-2', 'mb-3'];
    const pinned_posts = document.getElementsByName('pinned-post');
    for (let i = 0; i < pinned_posts.length; i++) {
        for (let j = 0; j < classs.length; j++) {
            const ps = pinned_posts[i].getElementsByTagName('p');
            for (let k = 0; k < ps.length; k++) {
                ps[k].classList.add(classs[j]);
            }
        }
    }
    classs = [ 'd-inline-block', 'text-gray', 'mb-2', 'pr-4'];
    const posts_posts = document.getElementsByName('posts-post');
    for (let i = 0; i < posts_posts.length; i++) {
        for (let j = 0; j < classs.length; j++) {
            const ps = posts_posts[i].getElementsByTagName('p');
            for (let k = 0; k < ps.length; k++) {
                ps[k].classList.add(classs[j]);
            }
        }
    }
</script>

</body>

</html>